<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>linux 防火墙 | quanlook</title><meta name="author" content="quanlook"><meta name="copyright" content="quanlook"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="linux 防火墙NetfilterNetfilter是Linux 2.4内核引入的全新的包过滤引擎，位于Linux内核中的包过滤功能体系，基于内核控制，实现防火墙的相关策略。Netfilter 由一些数据包过滤表组成，这些表包含内核用来控制信息包过滤的规则集。Netfilter在数据包必须经过且可以读取规则的位置，设有5个控制关卡。这5个关卡处的检查规则分别放在5个规则链中叫钩子函数（hook">
<meta property="og:type" content="article">
<meta property="og:title" content="linux 防火墙">
<meta property="og:url" content="https://quanlook.top/[object%20Object]/2023/11/01/firewall/index.html">
<meta property="og:site_name" content="quanlook">
<meta property="og:description" content="linux 防火墙NetfilterNetfilter是Linux 2.4内核引入的全新的包过滤引擎，位于Linux内核中的包过滤功能体系，基于内核控制，实现防火墙的相关策略。Netfilter 由一些数据包过滤表组成，这些表包含内核用来控制信息包过滤的规则集。Netfilter在数据包必须经过且可以读取规则的位置，设有5个控制关卡。这5个关卡处的检查规则分别放在5个规则链中叫钩子函数（hook">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/quanlook/ImgCdn/blog/202210182359257.jpg">
<meta property="article:published_time" content="2023-10-31T23:00:57.000Z">
<meta property="article:modified_time" content="2023-11-16T09:09:45.656Z">
<meta property="article:author" content="quanlook">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="运维">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/quanlook/ImgCdn/blog/202210182359257.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://quanlook.top/[object%20Object]/2023/11/01/firewall/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.19/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3709099053fb6ca2ed7827b7717e66ec";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'linux 防火墙',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-16 17:09:45'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://q1.qlogo.cn/g?b=qq&amp;nk=2935410273&amp;s=640" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">33</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/quanlook/ImgCdn/blog/202210182359257.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="quanlook"><span class="site-name">quanlook</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">linux 防火墙</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-31T23:00:57.000Z" title="发表于 2023-11-01 07:00:57">2023-11-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-16T09:09:45.656Z" title="更新于 2023-11-16 17:09:45">2023-11-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BF%90%E7%BB%B4/%E9%98%B2%E7%81%AB%E5%A2%99/">防火墙</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="linux 防火墙"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="linux-防火墙"><a href="#linux-防火墙" class="headerlink" title="linux 防火墙"></a>linux 防火墙</h1><h2 id="Netfilter"><a href="#Netfilter" class="headerlink" title="Netfilter"></a>Netfilter</h2><p>Netfilter是Linux 2.4内核引入的全新的包过滤引擎，位于Linux内核中的包过滤功能体系，基于内核控制，实现防火墙的相关策略。Netfilter 由一些数据包过滤表组成，这些表包含内核用来控制信息包过滤的规则集。Netfilter在数据包必须经过且可以读取规则的位置，设有5个控制关卡。这5个关卡处的检查规则分别放在5个规则链中叫<strong>钩子函数</strong>（hook functions）。也就是说5条链对应着数据包传输路径中的5个控制关卡，链中的规则会在对应的关卡检查和处理。任何一个数据包，只要经过本机，必然经过5个链中的某个或某几个。</p>
<p>Netfilter中的五个规则链</p>
<table>
<thead>
<tr>
<th>规则链</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>PREROUTING</td>
<td>数据包刚进入网络接口之后，路由之前</td>
</tr>
<tr>
<td>INPUT</td>
<td>数据包从内核流入用户空间</td>
</tr>
<tr>
<td>FORWARD</td>
<td>在内核空间中，从一个网络接口进入，到另一个网络接口去。转发过滤。</td>
</tr>
<tr>
<td>OUTPUT</td>
<td>数据包从用户空间流出到内核空间</td>
</tr>
<tr>
<td>POSTROUTING</td>
<td>路由后，数据包离开网络接口前</td>
</tr>
</tbody></table>
<p>链其实就是包含众多规则的检查清单，每一条链中包含很多规则。当一个数据包到达一个链时，系统就会从链中第一条规则开始检查，看该数据包是否满足规则所定义的条件。如果满足，系统就会根据该条规则所定义的方法处理该数据包；否则就继续检查下一条规则，如果该数据包不符合链中任何一条规则，系统就会根据该链预先定义的默认策略来处理数据包。五条链中最常用的是 INPUT 和 OUTPUT 链。因为，我们的主机一般都是判断该是否接收数据，而转发流量一般较少。</p>
<p><strong>数据包的传输过程</strong></p>
<ol>
<li>当一个数据包进入网卡时，它首先进入PREROUTING链，内核根据数据包目的IP判断是否需要转送出去。</li>
<li>如果数据包就是进入本机的，它就会沿着图向下移动，到达INPUT链。数据包到了INPUT链后，任何进程都会收到它。本机上运行的程序可以发送数据包，这些数据包会经过OUTPUT链，然后到达POSTROUTING链输出。</li>
<li>如果数据包是要转发出去的，且内核允许转发，数据包就会如图所示向右移动，经过FORWARD链，然后到达POSTROUTING链输出。</li>
</ol>
<p><img src="/[object%20Object]/2023/11/01/firewall/v2-3cbf4d38f1f8f47b93183a8465b2fc4f_720w.webp"></p>
<p>可以看出，刚从网络接口进入的数据包尚未进行路由决策，还不知道数据要走向哪里，所以进出口处没办法实现数据过滤，需要在内核空间设置转发关卡、进入用户空间关卡和离开用户空间关卡。</p>
<h2 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h2><p>iptables是用来管理防火墙的的工具，属于静态防火墙，我们通过 iptables 将过滤规则写入内核，然后 Netfilter 再根据规则进行过滤数据包。所以实际上iptables是通过调用 Netfilter 来进行防火墙管理的，它本身不具备过滤数据包的功能。iptables程序位于 <code>/sbin/iptables</code> ，配置文件位于 <code>/etc/sysconfig/iptables</code> 。在Rhel7之前，防火墙是用 iptables</p>
<p>iptables中也有和netfilter中一模一样的5种规则链，还多了4个规则表。规则表的作用是容纳各种规则链。规则表的划分依据是防火墙规则的作用。四个表中常用的是 filter 表。最常用的链是 INPUT 和 OUTPUT 链</p>
<p><strong>不指定表名时，默认指定 filter 表</strong></p>
<p>iptables中的四个规则表</p>
<table>
<thead>
<tr>
<th>规则表</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>raw表</td>
<td>确定是否对该数据包进行状态跟踪 kernel2.6之后加进去的</td>
</tr>
<tr>
<td>mangle表</td>
<td>为数据包设置标记</td>
</tr>
<tr>
<td>nat表</td>
<td>修改数据包中的源、目标ip或端口</td>
</tr>
<tr>
<td>filter表</td>
<td>确定是否放行该数据包(过滤)</td>
</tr>
</tbody></table>
<p><img src="/[object%20Object]/2023/11/01/firewall/v2-f7b68503e51cad0b3383268bf3eff863_720w.webp" alt="img"></p>
<p>规则表之间的匹配顺序： raw –&gt;mangle–&gt;nat–&gt;filter</p>
<p><strong>规则链之间的顺序：</strong></p>
<p>入站：PREROUTING –&gt; INPUT</p>
<p>出站：OUTPUT–&gt;POSTROUTING</p>
<p>转发：PREROUTING–&gt;FORWARD–&gt;POSTROUTING</p>
<p><strong>规则链的匹配顺序：</strong></p>
<p>按顺序依次检查， 匹配到了即停止(LOG策略例外)</p>
<p>若找不到相匹配的规则，则按该链的默认策略处理</p>
<p><img src="/[object%20Object]/2023/11/01/firewall/v2-448eca2f1ab75c58a78a938e14fd51be_720w.webp" alt="img"></p>
<p><strong>数据包的常见控制类型：</strong></p>
<ul>
<li>ACCEPT：允许通过</li>
<li>DROP：直接丢弃，不给出任何回应</li>
<li>REJECT：拒绝通过，必要时会给出提示</li>
<li>LOG：记录日志信息，然后传给下一条规则继续匹配</li>
</ul>
<p><strong>iptables的基本语法</strong></p>
<p>语法构成：iptables 【-t 表名】 选项 链名 条件 【-j 控制类型】</p>
<blockquote>
<p>iptables [-t 表名] 管理选项 [链名] [匹配条件] [-j 控制类型]</p>
</blockquote>
<p>1.不指定表名时，默认指filter表<br>2.不指定链名时，默认指表内的所有链<br>3.除非设置链的默认策略，否则必须指定匹配条件<br>4.选项、链名、控制类型使用大写字母，其余均为小写</p>
<ul>
<li>不指定链名时，默认指定表内的所有链</li>
<li>除非设置链的默认策略，否则必须指定匹配条件</li>
<li>选项、链名、控制类型使用大写字母，其余均为小写</li>
</ul>
<p><img src="/[object%20Object]/2023/11/01/firewall/117d7ddc5c354ebe9047b419511cf38f.png"></p>
<p><img src="/[object%20Object]/2023/11/01/firewall/v2-c98edf203edc4b797f28291d61636587_720w.webp" alt="img"></p>
<blockquote>
<h2 id="常用的控制类型"><a href="#常用的控制类型" class="headerlink" title="常用的控制类型"></a>常用的控制类型</h2><p>ACCEPT   允许数据包通过。<br>DROP    直接丢弃数据包，不给出任何回应信息。<br>REJECT  拒绝数据包通过，会给数据发送端一个响应信息。<br>SNAT     修改数据包的源地址。<br>MASQUERADE   伪装成一个非固定公网IP地址。<br>DNAT     修改数据包的目的地址。<br>PNAT  目标端口转换 端口修改<br>LOG      在&#x2F;var&#x2F;log&#x2F;messages文件中记录日志信息，然后将数据包传递给下一条规则。LOG只是一种辅助动作，并没有真正处理数据包。</p>
</blockquote>
<p><strong>规则的匹配条件</strong></p>
<p>通用匹配：可直接使用，不依赖于其他条件或扩展。包括网络协议、ip地址、网络接口等</p>
<ul>
<li>协议匹配：-p 协议名 <code>iptables -A INPUT -p icmp -j DROP</code></li>
<li>地址匹配：-s 源地址 、-d 目的地址 <code>iptables -A INPUT -s 192.168.10.0/24 -j DROP</code></li>
<li>接口匹配：-i 入站网卡 、-o 出站网卡<code>iptables -A INPUT -i eth0 -p icmp -j DROP</code></li>
</ul>
<p>隐含匹配：要求以特定的协议匹配作为前提，包括端口、TCP标记、ICMP类型等条件</p>
<ul>
<li>端口匹配：–sport 源端口 、–dport 目的端口 <code>iptables -A INPUT -p tcp --dprot 20:21 -j ACCEPT</code></li>
<li>TCP标记匹配：–tcp-flags 检查范围 被设置的标记</li>
<li>ICMP类型匹配：–icmp-type ICMP类型</li>
</ul>
<p>显式匹配：要求以 “ -m 扩展模块” 的形式明确指出类型，包括多端口、MAC地址、IP范围、数据包状态等</p>
<ul>
<li>多端口匹配：-m multiport –sport 源端口列表 -m multiport –dport 目的端口列表<code>iptables -A INPUT -p tcp -m multiport --dport 25,80,110,143 -j ACCEPT</code></li>
<li>IP范围匹配：-m iprange –src-range IP范围 <code>iptables -A FORWARD -p tcp -m iprange --src-range 192.168.4.21-192.168.4.28 -j ACCEPT</code></li>
<li>MAC地址匹配： -m mac –mac-source MAC地址<code>iptables -A INPUT -m mac --mac-source 00:0c:29:c0:55:3f -j DROP</code></li>
</ul>
<p><img src="/[object%20Object]/2023/11/01/firewall/v2-a19d20d51fd70280c6535db771514a7e_720w.webp" alt="img"></p>
<p><strong>添加新的规则：</strong></p>
<p>-A：在链的末尾追加一条规则<br>-I ：在链的开头(或指定序号插入)一条规则</p>
<ul>
<li><code>iptables -t filter -A INPUT -p tcp -j ACCEPT</code></li>
<li><code>iptables -A INPUT -p tcp -j ACCEPT</code></li>
<li><code>iptables -I INPUT -p udp -j ACCEPT</code></li>
<li><code>iptables -I INPUT 3 -p icmp -j ACCEPT</code> 在filter表中的INPUT链中的第3条加入一条允许所有icmp协议的规则</li>
</ul>
<p><strong>删除，清空规则(暂时，重启失效)</strong></p>
<p>-D：删除链内指定序号的一条规则<br>-F：清空所有的规则</p>
<ul>
<li><code>iptables -D INPUT 3</code></li>
<li><code>iptables -t raw -F</code></li>
<li><code>iptables -F</code></li>
</ul>
<p><strong>查看规则列表</strong></p>
<p>-L：列出所有的规则条目 （默认查看的是filter表）<br>-n：以数字形式显示地址、端口等信息 (地址用数字表示)<br>-v：以更详细的方式显示规则信息(显示比特流，发包的数量等信息)<br>–line-numbers：查看规则时，显示规则的序号</p>
<ul>
<li><code>iptables -L</code></li>
<li><code>iptables -nvL</code></li>
</ul>
<p><strong>设置默认规则</strong></p>
<p>-P：为指定的链设置默认规则</p>
<ul>
<li><code>iptables -t nat -P OUTPUT ACCEPT</code></li>
</ul>
<p><img src="/[object%20Object]/2023/11/01/firewall/v2-cfaf13e457309d2529adadb29f1bf9e2_720w-169880913588910.webp" alt="img"></p>
<p><strong>规则的备份和还原</strong></p>
<p>导出( 备份规则)：<code>iptables-save &gt; /tmp/xie/1.txt</code></p>
<p>&#x2F;&#x2F;将iptables配置文件保存到 &#x2F;tmp&#x2F;xie&#x2F;1.txt文件中</p>
<p>还原规则：<code>iptables-restore &lt; /tmp/xie/1.txt</code></p>
<p><strong>规则永久生效：</strong></p>
<p>iptables不是一个守护进程，我们修改只是当前的修改，重启服务或重启系统就会失效。要想使规则永久生效，需要保存规则： service iptables save ，使我们当前的配置保存到配置文件 &#x2F;etc&#x2F;sysconfig&#x2F;iptables 中，然后重启服务或者重启主机，使规则加载到内存，才能使配置永久生效。防火墙的运行需要建立在网络配置正常的前提下。</p>
<p><code>services iptables start / stop / restart</code> 开启&#x2F;停止&#x2F;重启 iptables服务</p>
<p><code>chkconfig --level 5 iptables on / off</code></p>
<p><strong>iptables做本地端口转发</strong></p>
<p>开启数据转发功能：<code>/etc/sysctl.conf</code> 设置 <code>net.ipv4.ip_forward=1</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -L         #查看端口转发记录</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#将192.168.10.21的2222端口的流量都转发给192.168.10.21的22端口</span></span></span><br><span class="line">iptables -t nat -A PREROUTING \</span><br><span class="line">  -d 192.168.10.21 -p tcp --dport 2222 \</span><br><span class="line">  -j DNAT --to-destination 192.168.10.21:22           </span><br><span class="line">iptables -save             #保存</span><br><span class="line">iptables -t nat -F         #清除规则</span><br></pre></td></tr></table></figure>

<p>做本地端口转发，将本地2222端口的流量转发给22端口</p>
<p><img src="/[object%20Object]/2023/11/01/firewall/v2-ec54bdc69b2148cb7c673bcba7247da4_720w-16988091319388.webp" alt="img"></p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><h4 id="SNAT"><a href="#SNAT" class="headerlink" title="SNAT"></a>SNAT</h4><p>源地址转换 （Source Network Address Translation）</p>
<blockquote>
<p>实现内网主机通过防火墙进行上网，需要使用SNAT（源地址转换POSTROUTING）</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">iptables -t net -A POSTROUTING  -s 192.168.100.0/24 -o eth0 -j SNET --to-source 192.168.200.10</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定从哪个ip地址转换出去（静态公网地址）</span></span><br><span class="line">iptables -t nat -I POSTROUTING -s 172.16.1.0/24 -j SNAT --to 10.0.0.200</span><br><span class="line">iptables -t nat -L -n</span><br></pre></td></tr></table></figure>

<h4 id="MASQUERADE"><a href="#MASQUERADE" class="headerlink" title="MASQUERADE"></a>MASQUERADE</h4><p>伪装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">当外网源地址为动态获取的地址时，MASQUERADE可自行判断要转换为的外网地址</span></span><br><span class="line">iptables -t nat -A POSTROUTING -s 172.16.1.0/24 -j MASQUERADE</span><br></pre></td></tr></table></figure>

<h4 id="DNAT"><a href="#DNAT" class="headerlink" title="DNAT"></a>DNAT</h4><p>目标地址转换 (Destination Network Address Translation)</p>
<blockquote>
<p>实现外网主机通过防火墙访问内部主机80端口，需要通过DNAT（目标地址转换PREROUTING）</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">地址映射【DNAT】</span></span><br><span class="line">iptables -t nat -I PREROUTING -d 10.0.0.200 -j DNAT --to 172.16.1.7</span><br></pre></td></tr></table></figure>

<h4 id="PNAT"><a href="#PNAT" class="headerlink" title="PNAT"></a>PNAT</h4><p>目标端口转换</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">端口映射【DNAT】</span></span><br><span class="line">iptables -t nat -I PREROUTING \</span><br><span class="line">-d 10.0.0.200 -p tcp --dport 80 \</span><br><span class="line">-j DNAT --to 172.16.1.7:80</span><br><span class="line">iptables -t nat -L -n</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把来自80端口的访问映射到本机的8080端口</span></span><br><span class="line">iptables -A PREROUTING -t nat \</span><br><span class="line">-d 192.168.10.11 -p tcp --dport 80 -j REDIRECT --to-ports 8080</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Firewalld"><a href="#Firewalld" class="headerlink" title="Firewalld"></a>Firewalld</h2><p>Firewalld自身并不具备防火墙的功能，而是和iptables一样需要通过内核的Netfilter来实现，也就是说firewalld和iptables一样，他们的作用都是用于维护规则，而真正使用规则干活的是内核的Netfilter，只不过Firewalld和iptables的结构以及使用方法不一样罢了。iptables是动态防火墙 dynamic firewall daemon 。支持ipv4和ipv6。Rhel7中默认将防火墙从iptables升级为 firewalld。firewalld相对于iptables主要的优点有：</p>
<ul>
<li>firewalld在使用上要比iptables人性化很多，即使不明白“四张表五条链”而且对TCP&#x2F;IP协议也不理解也可以实现大部分功能。</li>
</ul>
<p><strong>firewalld的配置模式</strong></p>
<p>firewalld的配置文件以xml格式为主（主配置文件firewalld.conf例外），他们有两个存储位置</p>
<ol>
<li>&#x2F;etc&#x2F;firewalld&#x2F;services&#x2F; 用户自定义配置文件</li>
<li>&#x2F;usr&#x2F;lib&#x2F;firewalld&#x2F;services&#x2F; 系统配置文件，预置文件，尽量不要修改</li>
</ol>
<p><img src="/[object%20Object]/2023/11/01/firewall/v2-fb6d47d03c660dd80e8ea60333e93689_720w.webp" alt="img"></p>
<p><strong>过滤规则集合：zone</strong></p>
<ul>
<li><p>一个zone就是一套过滤规则，数据包必须要经过某个zone才能入站或出站。不同zone中规则粒度粗细、安全强度都不尽相同。可以把zone看作是一个出站或入站必须经过的安检门，有的严格、有的宽松、有的检查的细致、有的检查的粗略。</p>
</li>
<li><p>每个zone单独对应一个xml配置文件，在目录<code>/usr/lib/firewalld/services/</code></p>
</li>
<li><p>每个zone都有一个默认的处理行为，包括：default(省缺)、 ACCEPT、REJECT、DROP</p>
</li>
<li><p>firewalld提供了9个zone：</p>
<ul>
<li><ul>
<li>drop 任何流入的包都被丢弃，不做任何响应。只允许流出的数据包。</li>
</ul>
</li>
<li>block 　 任何流入的包都被拒绝，返回<code>icmp-host-prohibited</code>报文(ipv4)或<code>icmp6-adm-prohibited</code>报文(ipv6)。只允许由该系统初始化的网络连接</li>
<li>public 默认的zone。部分公开，不信任网络中其他计算机，只放行特定服务。</li>
<li>external 只允许选中的服务通过，用在路由器等启用伪装的外部网络。认为网路中其他计算器不可信。</li>
<li>dmz 允许隔离区(dmz)中的电脑有限的被外界网络访问，只允许选中的服务通过。</li>
<li>work 用在工作网络。你信任网络中的大多数计算机不会影响你的计算机，只允许选中的服务通过。</li>
<li>home 用在家庭网络。信任网络中的大多数计算机，只允许选中的服务通过。</li>
<li>internal 用在内部网络。信任网络中的大多数计算机，只允许选中的服务通过。</li>
<li>trusted 允许所有网络连接，即使没有开放任何服务，那么使用此zone的流量照样通过（一路绿灯）。</li>
</ul>
</li>
</ul>
<p><strong>防火墙默认只激活public区域，不指定区域，默认是 public 区域</strong></p>
<p>防火墙状态监测</p>
<ul>
<li><code>firewall-cmd --list-all</code> &#x2F;&#x2F;列出所有的已配置接口的配置信息</li>
<li><code>firewall-cmd --state</code> &#x2F;&#x2F;查看防火墙的状态</li>
<li><code>firewall-cmd --get-active-zones</code> &#x2F;&#x2F;查看防火墙激活的zone区域</li>
<li><code>firewall-cmd --get-services</code> &#x2F;&#x2F;查看防火墙预定义的服务</li>
<li><code>firewall-cmd --get-default-zone</code>&#x2F;&#x2F;查看防火墙默认的zone区域</li>
<li><code>firewall-cmd --set-default-zone=home</code> &#x2F;&#x2F;将防火墙默认的区域设置为home区域</li>
<li><code>firewall-cmd --get-service --permanent</code> &#x2F;&#x2F;查看永久生效的服务</li>
<li><code>firewall-cmd --list-rich-rules</code> &#x2F;&#x2F;列出所有的富规则</li>
</ul>
<p><strong>防火墙的配置</strong></p>
<p>在区域中添加服务或端口：</p>
<p>临时设置：<code>firewall-cmd -zone=public --add-service=mysql</code></p>
<p><code>firewall-cmd --add-port=8080-8081/tcp</code> &#x2F;&#x2F;不写区域的话默认是public区域</p>
<p>在区域中移除服务或端口：</p>
<p>临时设置：<code>firewall-cmd --remove-service=https</code></p>
<p><code>firewall-cmd --remove-port=8080-8081/tcp</code></p>
<p>在区域中永久添加和移除服务或端口(–permanent参数)：</p>
<p>永久设置：<code>firewall-cmd --permanent --add-service=mysql</code></p>
<p><code>firewall-cmd --permanent --remove-port=8080-8081/tcp</code></p>
<p><code>firewall-cmd --reload</code> &#x2F;&#x2F;重载，永久设置需要重载配置文件才能生效</p>
<p>富规则：富规则允许你创建更复杂的配置</p>
<ul>
<li><code>firewall-cmd --zone=public --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.10.0/24&quot; service name=ssh accept &quot;</code> &#x2F;&#x2F;zone区域添加一个富规则，允许来自源网段192.168.10.0&#x2F;24 的数据</li>
<li><code>firewall-cmd --permanent --zone=public --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.10.0/24&quot; port protocol=&quot;tcp&quot; port=&quot;8080&quot; accept&quot;</code> &#x2F;&#x2F;在zone区域中永久添加一个富规则，允许来自源网段 192.168.10.0&#x2F;24 的tcp协议的8080端口的数据</li>
<li><code>firewall-cmd --zone=public --remove-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.10.0/24&quot; service name=&quot;http&quot; accept &quot;</code> &#x2F;&#x2F;移除zone区域的富规则–来自192.168.10.0&#x2F;24网段的http服务</li>
</ul>
<p><strong>防火墙的选择</strong></p>
<p>Rhel7中既有iptables防火墙，又有firewalld防火墙。但是同一时刻只能开一个，所以必须得关闭其中一个防火墙。一般我们都是关闭iptables防火墙，而打开firewalld防火墙，因为firewalld比iptables强大太多了。</p>
<p>开启firewalld防火墙，并且使其开机自启动，关闭iptables防火墙</p>
<ul>
<li><code>systemctl mask iptables.service</code> &#x2F;&#x2F;屏蔽iptables服务</li>
<li><code>systemctl start firewalld.service</code></li>
<li><code>systemctl enable firewalld.service</code></li>
</ul>
<p>打开路由转发功能 ：</p>
<ul>
<li><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></li>
<li><code>sysctl -w net.ipv4.ip_forward=1</code></li>
<li><code>vim /etc/sysctl.conf</code>, 将<code>net.ipv4.ip_forward=0</code> 改为 &#x3D;1，然后 <code>sysctl -p /etc/sysctl.conf</code> 使之生效 (永久开启IP转发)</li>
</ul>
<p>端口转发：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将外部访问本机10000端口的流量转发至本机22号端口</span></span><br><span class="line">firewall-cmd --zone=public \</span><br><span class="line">--add-rich-rule=&quot;rule family=ipv4 forward-port port=10000 protocol=tcp to-port=22&quot; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将外部访问本机8080端口流量转到192.168.10.24上的80端口</span></span><br><span class="line">firewall-cmd --zone=public \</span><br><span class="line">--add-forward-port=port=8080:proto=tcp:toport=80:toaddr=192.168.10.24</span><br></pre></td></tr></table></figure>

<h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://quanlook.top">quanlook</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://quanlook.top/[object%20Object]/2023/11/01/firewall/">https://quanlook.top/[object Object]/2023/11/01/firewall/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://quanlook.top" target="_blank">quanlook</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/linux/">linux</a><a class="post-meta__tags" href="/tags/%E8%BF%90%E7%BB%B4/">运维</a></div><div class="post_share"></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/%5Bobject%20Object%5D/2022/12/17/python-%E5%B7%A5%E5%85%B7%E7%B1%BB/" title="Python-工具类"><img class="cover" src="https://tuapi.eees.cc/api.php?category=dongman&amp;type=302" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Python-工具类</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/%5Bobject%20Object%5D/2020/11/25/nginx/" title="nginx 配置"><img class="cover" src="https://cdn.jsdelivr.net/gh/quanlook/ImgCdn/blog/202210182359257.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-25</div><div class="title">nginx 配置</div></div></a></div><div><a href="/%5Bobject%20Object%5D/2022/03/10/nginx%E6%B7%BB%E5%8A%A0SSL/" title="nginx添加SSL安全证书"><img class="cover" src="https://cdn.jsdelivr.net/gh/quanlook/ImgCdn/blog/202210182359258.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-10</div><div class="title">nginx添加SSL安全证书</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://q1.qlogo.cn/g?b=qq&amp;nk=2935410273&amp;s=640" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">quanlook</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">33</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/quanlook"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/quanlook" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:quanlook@126.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://gitee.com/quanlook" target="_blank" title="Gitee"><i class="iconfont gitee"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">quanlok Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#linux-%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-text">linux 防火墙</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Netfilter"><span class="toc-text">Netfilter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iptables"><span class="toc-text">iptables</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E6%8E%A7%E5%88%B6%E7%B1%BB%E5%9E%8B"><span class="toc-text">常用的控制类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-text">示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SNAT"><span class="toc-text">SNAT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MASQUERADE"><span class="toc-text">MASQUERADE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DNAT"><span class="toc-text">DNAT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PNAT"><span class="toc-text">PNAT</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Firewalld"><span class="toc-text">Firewalld</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="toc-text">示例</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/%5Bobject%20Object%5D/2023/11/01/firewall/" title="linux 防火墙"><img src="https://cdn.jsdelivr.net/gh/quanlook/ImgCdn/blog/202210182359257.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="linux 防火墙"/></a><div class="content"><a class="title" href="/%5Bobject%20Object%5D/2023/11/01/firewall/" title="linux 防火墙">linux 防火墙</a><time datetime="2023-10-31T23:00:57.000Z" title="发表于 2023-11-01 07:00:57">2023-11-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%5Bobject%20Object%5D/2022/12/17/python-%E5%B7%A5%E5%85%B7%E7%B1%BB/" title="Python-工具类"><img src="https://tuapi.eees.cc/api.php?category=dongman&amp;type=302" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python-工具类"/></a><div class="content"><a class="title" href="/%5Bobject%20Object%5D/2022/12/17/python-%E5%B7%A5%E5%85%B7%E7%B1%BB/" title="Python-工具类">Python-工具类</a><time datetime="2022-12-17T15:37:32.000Z" title="发表于 2022-12-17 23:37:32">2022-12-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%5Bobject%20Object%5D/2022/12/17/Python%20%E5%B8%B8%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/" title="Python-常用的第三方库整理"><img src="https://cdn.jsdelivr.net/gh/quanlook/ImgCdn/blog/202210182359259.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python-常用的第三方库整理"/></a><div class="content"><a class="title" href="/%5Bobject%20Object%5D/2022/12/17/Python%20%E5%B8%B8%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/" title="Python-常用的第三方库整理">Python-常用的第三方库整理</a><time datetime="2022-12-17T14:37:32.000Z" title="发表于 2022-12-17 22:37:32">2022-12-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%5Bobject%20Object%5D/2022/12/17/Redis-install/" title="Redis-install">Redis-install</a><time datetime="2022-12-17T14:21:42.000Z" title="发表于 2022-12-17 22:21:42">2022-12-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%5Bobject%20Object%5D/2022/03/26/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/" title="ELK日志收集"><img src="https://cdn.jsdelivr.net/gh/quanlook/ImgCdn/blog/202210182359256.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ELK日志收集"/></a><div class="content"><a class="title" href="/%5Bobject%20Object%5D/2022/03/26/ELK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/" title="ELK日志收集">ELK日志收集</a><time datetime="2022-03-26T04:07:00.000Z" title="发表于 2022-03-26 12:07:00">2022-03-26</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/quanlook/ImgCdn/blog/202210182359257.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By quanlook</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><img src="/img/icp.png"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/">桂ICP备2020007847号-1</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.19/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>